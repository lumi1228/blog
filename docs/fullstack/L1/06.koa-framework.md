---
lang: zh-CN
title: å·¥ç¨‹åŒ–ä¹‹æ‰“åŒ…å·¥å…· yeoman
description: é¡¹ç›®éœ€æ±‚åˆ†æï¼šä»ä¸šåŠ¡éœ€æ±‚åˆ°æŠ€æœ¯é€‰å‹çš„å…¨æµç¨‹å®è·µ
---


## ç« å¯¼å­¦
- Koaå¼€å‘è°ƒè¯•
- api



> å®˜æ–¹æ–‡æ¡£å‚è€ƒï¼š[koa-ä¸­æ–‡](https://koa.bootcss.com/)   
> æœ¬æ¡ˆä¾‹å‚è€ƒå½“å‰é¡¹ç›®å†…demoï¼š@/demo/koa-demo  
> å¼€å‘ç¯å¢ƒï¼šNode v18.20.8 ã€ koa ^3.1.1


## Koaä»‹ç»&æ ¸å¿ƒæ¦‚å¿µ
> Koa æ˜¯ä¸€ä¸ªæ–°çš„ **web æ¡†æ¶**ï¼Œè‡´åŠ›äºæˆä¸º web åº”ç”¨å’Œ API å¼€å‘é¢†åŸŸä¸­çš„ä¸€ä¸ªæ›´å°ã€æ›´å¯Œæœ‰è¡¨ç°åŠ›ã€æ›´å¥å£®çš„åŸºçŸ³ã€‚  
> åˆ©ç”¨ **async å‡½æ•°**ä¸¢å¼ƒå›è°ƒå‡½æ•°ï¼Œå¹¶å¢å¼ºé”™è¯¯å¤„ç†ã€‚ Koa æ²¡æœ‰**ä»»ä½•é¢„ç½®**çš„ä¸­é—´ä»¶ï¼Œå¯å¿«é€Ÿè€Œæ„‰å¿«åœ°ç¼–å†™æœåŠ¡ç«¯åº”ç”¨ç¨‹åºã€‚

#### ç‰¹ç‚¹ï¼š
- ç®€æ´
- æ”¯æŒasync/awaitè¯­æ³•
- ä¸°å¯Œçš„ä¸­é—´ä»¶
  
#### ä¸»è¦æ¦‚å¿µï¼š
- Koa Applicationï¼ˆåº”ç”¨ç¨‹åºï¼‰
- Contextï¼ˆä¸Šä¸‹æ–‡ï¼‰
- Requestï¼ˆè¯·æ±‚ï¼‰ã€Responseï¼ˆå“åº”ï¼‰

Koaå¤„ç†æµç¨‹å›¾ï¼š

![Koaå¤„ç†æµç¨‹å›¾](/images/l1-koa1.png)
<!-- <p style="text-align:left;">
  <img src="/images/l1-koa1.png" alt="Koaå¤„ç†æµç¨‹å›¾" width="400" />
</p> -->




## å®‰è£…ä¸ä½¿ç”¨

- åˆå§‹åŒ–é¡¹ç›®&å®‰è£…koaï¼Œç”Ÿæˆ `package.json`

```
$ cd koa-demo
$ npm init -y
$ npm install --save koa // å®‰è£…koaåˆ°ç”Ÿäº§ç¯å¢ƒ
```

- æ ¹ç›®å½•åˆ›å»º`index.js`ï¼Œç¼–å†™Koaåº”ç”¨

```js title="@/index.js"
const Koa = require('koa')
const app = new Koa()

app.use(async ctx=>{
    ctx.body = 'hello koa!'
})

app.listen(3000)
```

- å¯åŠ¨åº”ç”¨`$ node index.js`åï¼Œè®¿é—®`http://localhost:3000/`,ç½‘é¡µä¸­æ˜¾ç¤º`hello koa!`

## Koaå·¥ä½œåŸç†

![Koaå·¥ä½œåŸç†](/images/l1-koa2.png)

- éªŒè¯ä¸­é—´ä»¶æ‰§è¡Œé¡ºåºï¼š

```js title="@/middleware.js"
const Koa = require('koa')
const app = new Koa()

const middleware = async (ctx, next) => {
    console.log('this is middleware')
    next() // è°ƒç”¨ä¸‹ä¸€ä¸ªä¸­é—´ä»¶
    console.log('this is middleware after next')
}
const middleware1 = async (ctx, next) => {
    console.log('this is middleware1')
    next()
    console.log('this is middleware1 after next')
}

const middleware2 = async (ctx, next) => {
    console.log('this is middleware2')
    next()
    console.log('this is middleware2 after next')
}


app.use(middleware)
app.use(middleware1)
app.use(middleware2)

app.listen(3000)

// è¿è¡Œç»“æœï¼š
this is middleware
this is middleware1
this is middleware2
this is middleware2 after next
this is middleware1 after next
this is middleware after next

```
- è¿è¡Œ`node middleware`ï¼Œç»“æœåˆ†æï¼š
  - æŒ‰ç…§app.use()æ³¨å†Œçš„é¡ºåºæ‰§è¡Œ
  - next()è°ƒç”¨åæ‰æ‰§è¡Œä¸‹ä¸€ä¸ªä¸­é—´ä»¶ï¼Œè‹¥æ— next()ï¼Œåˆ™ä¸­é—´ä»¶æ‰§è¡Œå®Œåä¸å†ç»§ç»­
  - next()åçš„ä»£ç ï¼Œåœ¨next()è°ƒç”¨åæ‰æ‰§è¡Œï¼ŒæŒ‰ç…§é¡ºåºå…ˆè¿›åå‡º



## RESTfulæ¥å£å¼€å‘å‰ç«¯è§£å†³æ–¹æ¡ˆ ğŸš©

- ç»Ÿä¸€çš„æ•°æ®å¤„ç†
- å¸¸è§çš„GET/POST
- æ¥å£è°ƒè¯•åŠæ—¥å¿—è¾“å‡º

### ä½¿ç”¨ä¸­é—´ä»¶koa-routerã€koa-bodyã€@koa/corsã€koa-json

>  æœ¬èŠ‚æ˜¯å€ŸåŠ©koaä¸­é—´ä»¶å®ç°ä¸€ä¸ªç®€æ˜“çš„å¼€å‘RESTfulæ¥å£

* è·¯ç”±ï¼škoa-router 
* åè®®è§£æï¼škoa-body
* è·¨åŸŸå¤„ç†ï¼š@koa/cors
* JSONå¤„ç†ï¼škoa-json

- å®‰è£…ä¸­é—´ä»¶
```
$ npm install --S koa-router koa-body @koa/cors koa-json  // --Sç­‰ä»·äº--save
```

- ç¼–å†™è·¯ç”±è§„åˆ™

```js title="@/index.js"
const Koa = require('koa')
const Router = require('koa-router')
const { koaBody } = require('koa-body')
const cors = require('@koa/cors')
const json = require('koa-json')

const app = new Koa()
const router = new Router()
// const bodyParser = new body()

router.prefix('/api') // å®šä¹‰è·¯ç”±å‰ç¼€

router.get('/', async ctx=>{ // å®šä¹‰è·¯ç”±
    console.log(ctx)
    // console.log(ctx.request)
    ctx.body = 'hello koa!'
})

router.get('/api', async ctx=>{ // å®šä¹‰è·¯ç”±
    //get params
    const params = ctx.request.query
    console.log(params)
    ctx.body = {
        ...params,
        message: 'hello api!'
    }
})

router.post('/post', async ctx=>{
    const { body } = ctx.request // è§£æè¯·æ±‚ä½“ï¼Œæ‹¿åˆ°å®¢æˆ·ç«¯æäº¤çš„æ•°æ®
    console.log(body) 
    console.log(ctx.request)
    ctx.body = { // å“åº”ä½“è®¾ç½®ï¼ŒæŠŠå¤„ç†ç»“æœä½œä¸ºå“åº”è¿”å›
        ...body,
        message: 'hello post!'
    }
}) 


// app.use ä¼šæŒ‰ç…§æ³¨å†Œçš„é¡ºåºä¾æ¬¡æ‰§è¡Œ
app.use(koaBody())// è§£æè¯·æ±‚ä½“
app.use(cors())// å¤„ç†è·¨åŸŸè¯·æ±‚
app.use(json({pretty: false, param: 'pretty'}))// å¤„ç†JSONå“åº”ï¼Œpretty: false ä¸æ ¼å¼åŒ–JSONï¼Œparam: 'pretty' å‚æ•°å
app.use(router.routes()) 
    .use(router.allowedMethods()) // ä½¿ç”¨è·¯ç”±å…è®¸çš„æ–¹æ³•

app.listen(3000)
```
- å¯åŠ¨åº”ç”¨åï¼Œè®¿é—®`http://localhost:3000/`,ç½‘é¡µä¸­æ˜¾ç¤º`hello koa!`;
- è®¿é—®`http://localhost:3000/api/api`,ç½‘é¡µä¸­æ˜¾ç¤º`hello api!`;
- postmanè®¿é—®`http://localhost:3000/api/post`,è¿”å›è¯·æ±‚ä½“çš„bodyæ•°æ®





## Koaè·¯ç”±è¿›é˜¶é…ç½®
- è·¯ç”±å‹ç¼©ï¼škoa-combine-routers
- æŒ‰ç…§åŠŸèƒ½æ¨¡å—è¿›è¡ŒåŒºåˆ†
  
### å¼€å‘ç›®å½•ç»“æ„
- é™æ€èµ„æºï¼škoa-static
- ç»Ÿä¸€çš„é”™è¯¯å¤„ç†
- å®‰å…¨åŠæ—¥å¿—å¤„ç†ï¼š@koa/corsï¼Œkoa-helmet






é‡éš¾ç‚¹ï¼š
Koaå¸¸è§å¼€å‘åœºæ™¯ï¼Œç™»å½•æ³¨å†Œå®æˆ˜



## Koaé…ç½®å¼€å‘çƒ­åŠ è½½
### ES6è¯­æ³•æ”¯æŒ&webpacké…ç½®
- é…ç½®è°ƒè¯•è„šæœ¬
- ä½¿ç”¨Nodemon

### å¼€å‘çƒ­åŠ è½½
- åœ¨Koaåº”ç”¨ä¸­æ”¯æŒES6è¯­æ³•
